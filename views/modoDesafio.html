<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modo Desaf√≠o - Geometrilandia</title>
    <link rel="stylesheet" href="/css/desafio-style.css" />
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <!-- Fondo -->
    <div class="background">
      <img
        src="/img/background.png"
        alt="Fondo colorido"
        class="background-img"
      />
    </div>

    <!-- Bot√≥n, vidas y estrellas -->
    <div class="top-bar">
      <button class="back-button" onclick="volverAlMenu()">‚¨Ö Volver</button>
      <div class="vidas" id="vidasContainer">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
      <div class="stars" id="starContainer">
        <span class="star">‚≠ê</span>
        <span class="star">‚≠ê</span>
        <span class="star">‚≠ê</span>
        <span class="star">‚≠ê</span>
        <span class="star">‚≠ê</span>
      </div>
    </div>

    <!-- Barra de progreso -->
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Contenedor principal dividido: contador + juego -->
    <div class="layout-juego">
      <!-- Columna izquierda: Contador -->
      <div class="columna-contador">
        <p class="message-time">Tiempo restante</p>
        <div id="contadorTiempo" class="contador-tiempo">15</div>
        <img src="/img/reloj.png" class="reloj" alt="reloj imagen" />
      </div>

      <!-- Columna derecha: √Årea de juego -->
      <div class="columna-juego">
        <div class="game-area">
          <div class="content-box">
            <p class="instruction-text">¬°Encuentra las figuras!</p>
            <div class="figura-display" id="figuraDisplay">
              <!-- Las figuras se insertar√°n din√°micamente -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mago -->
    <img src="/img/mago.png" alt="Mago sonriente" class="mago-img" />

    <!-- RELOJ -->
    <!-- <img src="/img/victoria.png" alt="Reloj conteo" class="reloj" /> -->

    <!-- Bot√≥n de prueba (solo para desarrollo) -->
    <button
      id="btnPrueba"
      onclick="simularLectura()"
      style="
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 1000;
        padding: 10px;
        background: #ff5722;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      "
    >
      üß™ Simular Lectura
    </button>

    <audio id="fondoDesafio" loop>
      <source src="/audio/desafio.mp3" type="audio/mpeg" />
    </audio>
    <script>
      const music = document.getElementById("fondoDesafio");

      function iniciarMusicaFondo() {
        if (!music) return;
        music.volume = 0.06;

        // Intenta reproducir inmediatamente
        music.play().catch(() => {
          // Si falla (por pol√≠tica del navegador), espera a la primera interacci√≥n
          document.addEventListener("click", reproducirTrasInteraccion, {
            once: true,
          });
        });
      }

      function reproducirTrasInteraccion() {
        music.play().catch((err) => {
          console.warn("El navegador sigue bloqueando la reproducci√≥n:", err);
        });
      }

      window.addEventListener("DOMContentLoaded", () => {
        iniciarMusicaFondo();

        // Si se vuelve al dashboard desde otro modo (tipo back/forward)
        window.addEventListener("pageshow", (event) => {
          const tipo = performance.getEntriesByType("navigation")[0]?.type;
          if (event.persisted || tipo === "back_forward") {
            iniciarMusicaFondo();
          }
        });
      });
      window.addEventListener("beforeunload", () => {
        const music = document.getElementById("fondoDesafio");
        if (music) {
          music.pause();
          music.currentTime = 0;
        }
      });
    </script>

    <!-- Script -->
    <script src="/js/modo-desafio.js"></script>
  </body>
</html>
